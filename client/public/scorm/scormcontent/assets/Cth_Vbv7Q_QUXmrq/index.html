<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Discover Your Evidence Habits with Maher</title>
  <style>
    :root {
      color-scheme: light;
    }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background-color: #f5f7fb;
      margin: 0;
      padding: 0;
      color: #111827;
    }
    .wrapper {
      max-width: 720px;
      margin: 24px auto;
      padding: 24px;
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.08);
    }
    h1 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }
    p.description {
      margin-top: 0;
      margin-bottom: 1.5rem;
      color: #4b5563;
      font-size: 0.95rem;
    }
    .section-title {
      font-weight: 600;
      margin: 1.25rem 0 0.5rem;
    }
    .checkbox-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 0.35rem 1rem;
      margin-bottom: 0.75rem;
    }
    label {
      font-size: 0.9rem;
      color: #374151;
      display: flex;
      align-items: flex-start;
      gap: 0.45rem;
    }
    input[type="checkbox"] {
      margin-top: 0.2rem;
    }
    textarea {
      width: 100%;
      min-height: 90px;
      padding: 10px 12px;
      margin-top: 0.35rem;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-family: inherit;
      font-size: 0.95rem;
      line-height: 1.45;
      resize: vertical;
      box-sizing: border-box;
      color: inherit;
      background: #ffffff;
    }
    textarea:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.25);
    }
    .hint {
      font-size: 0.8rem;
      color: #6b7280;
      margin-top: 0.15rem;
    }
    button {
      margin-top: 1.5rem;
      padding: 11px 22px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #2563eb, #6366f1);
      color: white;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      box-shadow: 0 10px 20px rgba(37, 99, 235, 0.22);
      transition: transform 0.15s ease, filter 0.15s ease, box-shadow 0.15s ease;
    }
    button:hover:not(:disabled) {
      filter: brightness(1.05);
      transform: translateY(-1px);
      box-shadow: 0 12px 22px rgba(37, 99, 235, 0.28);
    }
    button:disabled {
      cursor: not-allowed;
      opacity: 0.65;
      box-shadow: none;
    }
    .note {
      margin-top: 0.75rem;
      font-size: 0.8rem;
      color: #6b7280;
    }
    .reflection-card {
      margin-top: 1.75rem;
      padding: 18px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
    }
    .reflection-card h2 {
      margin: 0 0 0.5rem;
      font-size: 0.95rem;
      color: #111827;
    }
    .reflection-card p {
      margin: 0;
      font-size: 0.95rem;
      line-height: 1.55;
      color: #1f2937;
    }
    .error {
      margin-top: 1.5rem;
      padding: 14px 16px;
      border-radius: 10px;
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: #b91c1c;
      font-size: 0.9rem;
    }
    .api-key-note {
      margin-top: 0.85rem;
      font-size: 0.75rem;
      color: #6b7280;
      line-height: 1.4;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <h1>Discover Your Evidence Habits with Maher</h1>
    <p class="description">
      Take a quick look at the kinds of evidence you usually collect about your students’ learning.
      Just a quick reflection to help you understand your teaching data in a new way.
    </p>

    <form id="reflection-form">
      <div>
        <div class="section-title">1. Which types of assessment or evidence do you usually collect in a typical week?</div>
        <p class="hint">Think about one normal week in your classroom and tick all that apply.</p>
        <div class="checkbox-grid">
          <label><input type="checkbox" name="dataTypes" value="Quizzes or tests" /> Quizzes or tests</label>
          <label><input type="checkbox" name="dataTypes" value="Projects or presentations" /> Projects or presentations</label>
          <label><input type="checkbox" name="dataTypes" value="Exit tickets or quick checks" /> Exit tickets or quick checks</label>
          <label><input type="checkbox" name="dataTypes" value="Class discussions or participation" /> Class discussions or participation</label>
          <label><input type="checkbox" name="dataTypes" value="Homework or online tasks" /> Homework or online tasks</label>
          <label><input type="checkbox" name="dataTypes" value="Observation notes / behaviour" /> Observation notes / behaviour</label>
          <label><input type="checkbox" name="dataTypes" value="Self- or peer-assessment" /> Self- or peer-assessment</label>
          <label><input type="checkbox" name="dataTypes" value="Student reflections or journals" /> Student reflections or journals</label>
          <label><input type="checkbox" name="dataTypes" value="Other (informal notes, conversations, etc.)" /> Other (informal notes, conversations, etc.)</label>
        </div>
      </div>

      <div>
        <div class="section-title">2. Which type works best with your students, and why?</div>
        <textarea id="works-best" placeholder="For example: Exit tickets work best because they quickly show me who is confused before the next lesson."></textarea>
      </div>

      <div>
        <div class="section-title">3. Is there a type of evidence you think you might be overlooking, but that could be useful?</div>
        <textarea id="overlooked" placeholder="For example: I rarely collect student reflections, but they could help me understand how confident students feel."></textarea>
        <p class="hint">There is no right or wrong answer – this is just to help you think ahead.</p>
      </div>

      <button type="submit" id="submit-button">
        Check in With Maher
      </button>
    </form>

    <p class="note">
      Maher, your AI reflection partner, will use your responses to give you a short summary of your current evidence habits and one gentle suggestion to try next.
    </p>

    <p class="api-key-note">
      These responses are not stored or documented—they’re just for your practice with Maher.
    </p>

    <div id="error-message" class="error" style="display: none;"></div>

    <div id="reflection-container" class="reflection-card" style="display: none;">
      <h2>Maher’s reflection</h2>
      <p id="reflection-text"></p>
    </div>
  </div>

  <script>
    const form = document.getElementById('reflection-form');
    const submitButton = document.getElementById('submit-button');
    const errorMessage = document.getElementById('error-message');
    const reflectionContainer = document.getElementById('reflection-container');
    const reflectionText = document.getElementById('reflection-text');

    let openAIApiKey = '';

    const systemPrompt = `You are Maher, a warm and practical instructional coach helping teachers become more data-driven in a calm, supportive way.

Write a very short reflection (60–90 words).
Use a friendly, encouraging tone.

Follow this structure:
Start with 1–2 sentences affirming a genuine strength in how they already gather evidence.
In 1–2 sentences, name their current “evidence habit” (for example: mostly tests, mostly observations, mostly reflections, mostly participation, etc.).
In 1–2 sentences, offer one specific, realistic suggestion for a new or overlooked type of evidence they could try, connected to what they wrote.
End with one short, motivating line, such as “You already hold valuable evidence—now it can start guiding your decisions.” or “Small changes in what you notice can lead to big changes in learning.”

Avoid jargon. Do not use bullet points. Write as if you are talking to a busy classroom teacher at the end of the day.`;

    const buildUserMessage = (dataTypes, worksBest, overlooked) => `You will receive:

A list of assessment/evidence types the teacher usually collects in a typical week.
Their answer about which type works best with their students and why.
Their answer about which type they might be overlooking, but that could be useful.

Teacher’s inputs:
• Data types collected: ${dataTypes.length ? dataTypes.join(', ') : 'None provided'}
• Works best because: ${worksBest || 'Not provided'}
• Overlooked but useful: ${overlooked || 'Not provided'}`;

    form.addEventListener('submit', async (event) => {
      event.preventDefault();

      errorMessage.style.display = 'none';
      reflectionContainer.style.display = 'none';
      reflectionText.textContent = '';

      if (!openAIApiKey) {
        const providedKey = window.prompt('Enter your OpenAI API key to check in with Maher:');
        if (!providedKey) {
          errorMessage.textContent = 'An OpenAI API key is required to generate Maher’s reflection.';
          errorMessage.style.display = 'block';
          return;
        }
        openAIApiKey = providedKey.trim();
      }

      const dataTypes = Array.from(
        form.querySelectorAll('input[name="dataTypes"]:checked')
      ).map((input) => input.value);
      const worksBest = document.getElementById('works-best').value.trim();
      const overlooked = document.getElementById('overlooked').value.trim();

      submitButton.disabled = true;
      const originalLabel = submitButton.textContent;
      submitButton.textContent = 'Checking in…';

      try {
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            Authorization: `Bearer ${openAIApiKey}`,
          },
          body: JSON.stringify({
            model: 'gpt-4o-mini',
            temperature: 0.7,
            messages: [
              { role: 'system', content: systemPrompt },
              { role: 'user', content: buildUserMessage(dataTypes, worksBest, overlooked) },
            ],
          }),
        });

        if (!response.ok) {
          if (response.status === 401) {
            openAIApiKey = '';
            throw new Error('API key was rejected. Please check the key and try again.');
          }
          const errorData = await response.json().catch(() => ({}));
          const message = errorData?.error?.message || 'Unable to reach Maher right now.';
          throw new Error(message);
        }

        const data = await response.json();
        const reflection = data?.choices?.[0]?.message?.content?.trim();

        if (!reflection) {
          throw new Error('Maher sent an empty response. Please try again.');
        }

        reflectionText.textContent = reflection;
        reflectionContainer.style.display = 'block';
        reflectionContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
      } catch (error) {
        console.error(error);
        errorMessage.textContent = error.message || 'Something went wrong. Please try again in a moment.';
        errorMessage.style.display = 'block';
      } finally {
        submitButton.disabled = false;
        submitButton.textContent = originalLabel;
      }
    });
  </script>
</body>
</html>

